# 项目实践经验

## 合理设计显示控制逻辑

1. 需求：当用户改变浏览器宽度，两个元素有可能挤在一起，那么当他们刚要发生挤压时，将右边的元素display：none

2. 不合理的设计思路：用左.getBoundaryRect.right > 右.getBoundaryRect.left判断显示逻辑

这么做的不好之处在于，当我们将右隐藏时，框架底层可能会删除DOM，那么我们的ref就会面临刷新的问题，有时会出现bug

3. 正确的设计思路

用容器的总宽度减去左的宽度，计算剩余空间够不够放下右

4. 合理命名变量

5. 修改项目字段之前先全局查一下，特别注意有没有后端也是这么做的

## 项目开发流程

1. 产品出需求文档

2. 需求宣讲

3. 设计出设计稿

    - UI设计

    - 交互设计

4. 前后端同时开发

    - 前端需要接口时可以自己mock

    - 其中需要有细节问题时就和产品、设计交流

    - 建自己的特性分支在其上开发、途中可以在自己的特性分支多次commit

5. 前后端联调

6. 提测并且产品、设计在同时走查

    - 在自己的特性分支上merge一回master

        ```bash
        feature> git add .
        feature> git commit -m "..."
        feature> git checkout master
        master> git pull
        master> git checkout feature
        feature> git merge master
        # 处理新的冲突之后
        feature> git add . #建议分别单独add
        feature> git commit -m "feat: merge"
        feature> git push origin feature
        ```

    - 提交提测单（包含分支信息）

    - build测试版本到线上

    - 修改bug、不符合需求的地方（测试和产品、设计独立、所以测试通过了也不意味着产品、设计符合需求）

    - 如果没有大改动，不需要走测试，给测试说一声就行，如果有大改动就变成新的优化需求

7. 提出pull request请求和并特性分支到master

8. 构建预发环境、测试人员进行回归测试（就是再一次测试）

9. 没问题了就进行上线、同时进行后端配置

## git使用技巧

vscode安装插件`GitLens`辅助git流程

1. git stash

    暂存当前改动，回到本地仓库最新一次commit的状态

2. git pop

    抽出暂存改动，恢复到修改状态

3. 撤销上一次commit

    参考[git 取消commit](https://www.cnblogs.com/lyy-2016/p/6509707.html)

    1. 第一种情况：还没有push，只是在本地commit

        ```bash
        git reset --soft|--mixed|--hard <commit_id>
        git push develop develop --force  (本地分支和远程分支都是 develop)  
        ```

        这里的`<commit_id>`就是每次commit的`SHA-1`，可以在log里查看到

        `--mixed`    会保留源码,只是将git commit和index 信息回退到了某个版本.

        `--soft`   保留源码,只回退到commit信息到某个版本.不涉及index的回退,如果还需要提交,直接commit即可.

        `--hard`    源码也会回退到某个版本,commit和index 都会回退到某个版本.(注意,这种方式是改变本地代码仓库源码)

        当然有人在push代码以后,也使用 reset --hard <commit...> 回退代码到某个版本之前,但是这样会有一个问题,你线上的代码没有变,线上commit,index都没有变,当你把本地代码修改完提交的时候你会发现全是冲突.....这时换下一种

    2. commit push 代码已经更新到远程仓库

        对于已经把代码push到线上仓库,你回退本地代码其实也想同时回退线上代码,回滚到某个指定的版本,线上,线下代码保持一致.你要用到下面的命令

        ```bash
        git revert <commit_id>
        ```

        revert 之后你的本地代码会回滚到指定的历史版本,这时你再 git push 既可以把线上的代码更新。

        **注意：git revert是用一次新的commit来回滚之前的commit，git reset是直接删除指定的commit，看似达到的效果是一样的,其实完全不同。**

        第一:上面我们说的如果你已经push到线上代码库, reset 删除指定commit以后,你git push可能导致一大堆冲突.但是revert 并不会.

        第二:如果在日后现有分支和历史分支需要合并的时候,reset 恢复部分的代码依然会出现在历史分支里.但是revert 方向提交的commit 并不会出现在历史分支里.

        第三:reset 是在正常的commit历史中,删除了指定的commit,这时 HEAD 是向后移动了,而 revert 是在正常的commit历史中再commit一次,只不过是反向提交,他的 HEAD 是一直向前的.


4. 如何撤销上一次add

    > add: `git status`之后在 “Changes to be committed” 这行下面的，就说明是已暂存状态。也就是说这些文件被add过，但是没有commit。如果此时提交，那么该文件此时此刻的版本将被留存在历史记录中。

    - 撤销全部上一次add

        ```bash
        git reset HEAD
        ```

    - 撤销某个文件的add

        ```bash
        git reset HEAD <路径/文件名>
        ```

    另外、使用`GitLens`插件可以直接对文件进行加减按钮的操作会更方便

5. 拉取远程某个分支

    拉取远程所有分支

    ```bash
    git fetch origin
    ```

    拉取远程某个分支

    ```bash
    git fetch origin <branch>
    ```

    注意：fetch可以在任何分支进行，并不会对当前分支有所影响，但是pull = fetch + merge所以会有影响

    另外，可以通过在master分支进行git pull也可以拿到远程的分支信息

6. 对比多个分支

    一般来说用`GitLens`插件的`search & compare`比较方便

    另外可以参考[git diff的最全最详细的4大主流用法](https://blog.csdn.net/wq6ylg08/article/details/88798254)


7. 将多个commit合并为一个commit

    一般来说最后一次合master的时候进行一次rebase比较好

8. 创建一个分支

    `git checkout -b xxx`的含义是**在当前分支的基础**上分出来一个新的**本地分支**

    只有当我们git push origin xxx的时候远程会检测有没有这个分支，如果没有就创建一个远程分支


